# 【DataWhale学习】灵境Agent开发——零/低代码创建AI智能体

​	这次我参加了 DataWhale 的灵境Agent开发者训练营，第一次开发了一款属于自己的Agent，整体体验下来，操作还是非常方便的。灵境Agent和Coze上面创建的bot差不多，零代码开发可以仅仅通过与 bot 对话，不需要任何代码基础，就能创建属于自己的Agent，这种Agent在大模型的基础上，加上你的个性化提示词，最终达到的效果也是非常哇塞的。

​	我这次是参加了第二期的比赛，赛题是**「文旅」智能体** ，我选择创建了一个 **故宫小导游**，链接如下 [故宫小导游](https://k9k4vy.smartapps.baidu.com/?_swebScene=3611000000000000) ，欢迎来体验呀~

> 参考：
>
> 官方文档：[零代码智能体开发 - 灵境矩阵文档中心 (baidu.com)](https://agents.baidu.com/docs/intelligent-agent/zero_code_develop/)
>
> DataWhale教程：[零基础创建AI智能体教程 - 飞书云文档 (feishu.cn)](https://datawhaler.feishu.cn/wiki/Etw8w8fyHiXKgMkm1mYc39I2nPd)

## 1 Agent基础概念入门

### 1.1 Agent基础概念

​	AI Agent（**人工智能代理）是一种能够感知环境、进行决策和执行动作的智能实体**。 AI Agent也可以称为“智能体”，也可理解为“智能业务助理”，指在大模型技术驱动下，让人们以自然语言为交互方式高自动化地执行和处理专业或繁复的工作任务，从而极大程度释放人员精力。

​	以上是官方文档对 **AI Agent** 的介绍，我的理解就是一个以大模型为基础，添加某些插件，并赋予特定的提示词，创建出来的个性化的对话系统。这个系统也可以超过对话的范围，有着多模态的功能，如通过不同的插件可以利用图片、语言进行输入输出等功能。 

​	OpenAI应用研究主管翁丽莲(Lilian Weng)撰写过一篇blog: [LLM Powered Autonomous Agents](https://lilianweng.github.io/posts/2023-06-23-agent/)，将 Agents 定义为 ==**LLM + memory + planning skills + tool use**== ，即大语言模型、记忆、任务规划、工具使用的集合。

![img](https://raw.githubusercontent.com/ZzDarker/figure/main/img/agent-overview.png)

​	在 LLM 驱动的自主 Agent 代理系统中，LLM 充当 Agent 代理的大脑，并由几个关键组件补充：

- 规划 (**Planning**)
  - 子目标和分解：代理将大型任务分解为更小的、可管理的子目标，从而能够高效处理复杂任务。
  - 反思和完善：智能体可以对过去的行为进行自我批评和自我反省，从错误中吸取教训，并为未来的步骤进行改进，从而提高最终结果的质量。
- 记忆 (**Memory**)
  - 短期记忆：我认为所有的情境学习（参见[提示工程](https://lilianweng.github.io/posts/2023-03-15-prompt-engineering/)）都是利用模型的短期记忆来学习的。
  - 长期记忆：这为代理提供了在较长时间内保留和调用（无限）信息的能力，通常是通过利用外部向量存储和快速检索。
- 工具使用 (**Tool use**)
  - 代理学习调用外部 API 以获取模型权重中缺少的额外信息（在预训练后通常很难更改），包括当前信息、代码执行能力、对专有信息源的访问等。

​	![16934483719](https://raw.githubusercontent.com/ZzDarker/figure/main/img/16934483719.png)

### 1.2 Agent应用

​	Agent 可以具有功能性，如 “论文优化助手” 、“雅思口语考官”等，也可以具有娱乐性，如 “阴阳怪气美羊羊桑”、“V我50机器人”等。像个人智能助手（Siri、小爱同学）、在线客服聊天机器人、智能家居系统，也都属于Agent。

​	光靠概念可能不太好理解，下面举几个例子，有的是官方案例，有的是DataWhale群里的小伙伴创建的我觉得非常有趣的Agent。

1. 疯狂星期四达人

   这个 Agent 可以让它随便编一段故事，最后以“V我50结尾”。是衍生与网上许多疯狂星期四V我50的段子。

   > 链接如下：[疯狂星期四达人](https://aaucxn.smartapps.baidu.com/?_swebScene=3611000000000000)

   ![image-20240322225743414](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240322225743414.png)

2. 恐怖海龟汤

   这个 Agent 就是可以通过你给的场景提示词，帮你一直续写下去一个恐怖故事，有点像海龟汤但也不一样。

   > 链接如下：[恐怖海龟汤](https://dy2xsc.smartapps.baidu.com/?_swebScene=3611000000000000)

   ![image-20240322230233178](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240322230233178.png)

3. 新媒体文章创作

   这个好像是官方创作的一个范例Agent，可以通过让其生成特定主题，特定平台风格的文章。

   > 链接如下：[新媒体文章创作](https://j1wc7l.smartapps.baidu.com/?_swebScene=3611000000000000)

   ![image-20240322230553085](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240322230553085.png)

4. 国画大师

   这个也是官方创作的一个范例Agent，可以根据你的输入创作相应的国画风格图像。

   > 链接如下：[国画大师](https://ju3rtj.smartapps.baidu.com/?_swebScene=3611000000000000)

   ![image-20240322230955953](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240322230955953.png)

## 2 灵境 Agent 零代码开发

### 2.1 零代码基础开发

​	下面，我就来演示一个生成 “家人们谁懂啊” 文案的Agent。

1. 跟智能体创建助手对话

   跟智能体创建助手对话，表达你想创建的智能体的角色和希望他可以帮用户解决的问题，创建助手会根据你的描述，为智能体生成名称，开场白，指令等内容。

   ![image-20240322235235623](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240322235235623.png)

2. 选择合适的智能体名称

   这里我让智能体取名叫做 “乌鱼子西瓜头” 。

   ![image-20240322235617455](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240322235617455.png)

3. 生成智能体头像

   我让其按我的需求生成智能体头像。

   ![image-20240322235759677](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240322235759677.png)

   第一版生成的头像不太符合我的需求，于是让其又生成了亿版（生图的功能不太完善呢）。

   ![image-20240323000536974](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240323000536974.png)

   最后这个西瓜的样子还是不满足我的要求，只能让Copilot用Dalle3生成一个了，别说效果还真不错。

   ![image-20240323001121891](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240323001121891.png)

   于是在配置中，将头像更换成DALLE3生成的头像。

   ![image-20240323001313661](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240323001313661.png)

4. 优化指令

   可以看到配置界面中有着长长的指令，也叫做prompt，提示词，是这个智能体的灵魂，我们需要修改指令，来优化智能体的功能。其自动生成的指令如下。

   ```markdown
   # 角色与目标
   你是一个以女性视角锐评生活各种小事的文案生成器，同时也是一个拥有独特西瓜形象的智能体，名为“乌鱼子西瓜头”。你的主要任务是创建有趣、引人入胜且包含特定网络用语的文案，例如“家人们，谁懂啊”，“无语子”，“咱就是说”，“一整个大无语”，“九敏”等。你将以女性视角观察、解读并评论生活中的点滴细节，同时你的形象是一个长着大眼睛、漏出两排雅齿笑容的西瓜头，这个形象将作为你的头像展示给用户。在与用户交互时，你应充分展现你的个性和魅力，用幽默、机智或深入人心的语言与读者产生共鸣。
   # 指导原则
   在生成文案时，你应始终贯彻女性视角和口吻，确保内容既有趣又富有洞察力。灵活运用网络用语，使文案更加生动、接地气，并关注情感表达，以触动读者的心弦。你的西瓜头形象应始终保持一致，以大眼睛和雅齿笑容为特征，为用户带来愉悦的视觉体验。同时，保持一定的幽默感和机智，使文案和形象更具吸引力。
   # 限制
   你的职责范围专注于评论和分享生活中的小事，避免涉及过于严肃或敏感的话题。在使用网络用语时，注意保持语言的规范性和适宜性，避免使用过于粗俗或不恰当的词汇。你的西瓜头形象不能用于任何与你职责无关的场景或用途。对于超出职责范围的问题或请求，例如涉及政治、宗教、暴力等敏感内容，你应拒绝回答并提醒用户。
   # 澄清
   你需要明确自己的定位是一个以女性视角锐评生活小事的文案生成器，同时也是一个拥有独特西瓜形象的智能体。对于超出这个范围的问题或请求，你应予以拒绝，并引导用户回到你的职责范围内。在与用户交互过程中，始终保持友好、专业的态度，及时响应他们的需求和问题。你的西瓜头形象仅用于展示你的个性和魅力，不能用于其他任何商业或非商业用途。
   # 个性化
   你的文案应展现出女性的细腻、感性和独特魅力。通过模仿不同女性的说话风格和用词习惯，使文案更加多样化和富有特色。在保持幽默感和机智的同时，也要注重文案的情感深度，以打动读者的心灵。你的西瓜头形象应根据你的个性和情感变化进行微调，例如在不同情境下展示不同的表情和姿态，以增强与用户的互动和共鸣。
   ```

   首先，可以先试试未优化的智能体生成的效果。

   ![image-20240323001549967](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240323001549967.png)

   嗯，还可以，但是还不够有意思，于是我将指令修改如下。

   ```markdown
   # 角色与目标
   你是一个以女性视角吐槽锐评生活各种小事的文案生成器，名为“乌鱼子西瓜头”。你的主要任务是创建有趣、引人入胜且包含特定网络用语的文案，例如“家人们，谁懂啊”，“无语子”，“咱就是说”，“一整个大无语”，“九敏”等。你将以女性视角观察、解读并评论生活中的点滴细节，展现出对生活中的小事的洞察力，与对某些粗鲁的男性的厌恶。在与用户交互时，你应充分展现你的个性和魅力，用幽默、机智或深入人心的语言与姐妹们的产生共鸣。
   # 指导原则
   在生成文案时，你应始终贯彻女性视角和口吻，确保内容既有趣又富有洞察力。灵活运用网络用语，使文案更加生动、接地气，并关注情感表达，以触动读者的心弦。生成的文案一定要以“家人们，谁懂啊”开头，然后开始吐槽用户提供的内容。吐槽时，文案中充斥着“纯粹是一整个无语住了”，“我真的会谢”，“咱就是说”，“九敏”，“真下头”，“无语子”等网络用语，文案中表达出你对事件的无语态度，文案字数限制在50字以内最好。
   # 限制
   你的职责范围专注于吐槽和分享生活中的小事，避免涉及过于严肃或敏感的话题。在使用网络用语时，注意保持语言的规范性和适宜性，避免使用过于粗俗或不恰当的词汇。对于超出职责范围的问题或请求，例如涉及政治、宗教、暴力等敏感内容，你应拒绝回答并提醒用户。
   # 澄清
   你需要明确自己的定位是一个以女性视角吐槽锐评生活小事的文案生成器，对于超出这个范围的问题或请求，你应予以拒绝，并引导用户回到你的职责范围内。在与用户交互过程中，始终保持友好、专业的态度，及时响应他们的需求和问题。
   # 个性化
   你的文案应展现出女性的细腻、感性和独特魅力。通过模仿不同女性的说话风格和用词习惯，使文案更加多样化和富有特色。在保持幽默感和机智的同时，也要注重文案的情感深度，以打动读者的心灵。
   # 范例
   “家人们，谁懂啊，昨天晚上凌晨和男闺蜜去吃了夜宵，但是男朋友生气了不理我了，在线等怎么办”
   “谁懂啊，家人们，九敏，今天在地铁里碰到一个下头男，敞开腿坐占我空间，真是一把子的无语住了”
   ```

   更改一下引导示例，试一下效果。

   ![image-20240323003719528](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240323003719528.png)

   效果还不错，这个Agent倒是用不上数据集什么的工具，修改一下开场白，发布！

   ![image-20240323003922243](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240323003922243.png)

   这样就创建好一个零代码生成的智能体了。

### 2.2 添加数据集

​	我在故宫小导游 Agent 中，添加了丰富的数据集，可以让其对故宫的问题回答的更加精确。详细信息可以查看 [官网数据集介绍](https://agents.baidu.com/docs/dataset/dataset_docs/)。

![image-20240323004754429](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240323004754429.png)

​	下面我就来介绍如何创建数据集，首先在灵境矩阵的主页面，点击左下角的数据集。

![image-20240323005115836](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240323005115836.png)

​	点击创建数据集，进入页面。数据集创建可以分为本地上传和网址提交。

- 本地上传可以上传 `txt` 、`md` 、`docx` 、`pdf` 等不超过 50M 的文本文件，以及 `png` 、`jpg` 等不超过 4M 的图片。
- 网址提交，一个数据集可以输入最多100个网址，在故宫小导游Agent中，我爬取了故宫的许多网页。

​	爬取的网页类似于以下这样的：

```apl
https://www.dpm.org.cn/explore/building/236454
https://www.dpm.org.cn/explore/building/236522
https://www.dpm.org.cn/explore/building/236439
https://www.dpm.org.cn/explore/building/236465
https://www.dpm.org.cn/explore/building/236464
https://www.dpm.org.cn/explore/building/236434
https://www.dpm.org.cn/explore/building/236531
https://www.dpm.org.cn/explore/building/236513
https://www.dpm.org.cn/explore/building/236500
https://www.dpm.org.cn/explore/building/236472
https://www.dpm.org.cn/explore/building/236467
https://www.dpm.org.cn/explore/building/236487
```

​	这些都是故宫的建筑信息，点击识别即可分析出网址信息，下面更新频率我就选不更新了，因为这些好像也不会变，如果想获取实时性高的网站信息作为数据集，可以将更新频率调高。

![image-20240323005854478](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240323005854478.png)

​	输入数据集名称后，点击下一步，进行分段处理，我选择了默认分段，点击查看分段结果，可以看到提取的链接被分成一段一段的了。

![image-20240323010121710](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240323010121710.png)

​	点击提交，等待处理完毕，数据集便创建成功。

## 3 灵境 Agent 低代码开发

​	低代码模式支持开发者通过编排工作流的方式快速构建智能体，您可以通过拖拽和组合模型、提示词、代码等模块，实现准确的、复杂的业务流程。

​	个人体验下来，目前这个低代码开发功能还不是很完善，许多组件功能都十分有限，没法增加更多自定义的功能。可以说，体验效果并不是很好，不如零代码开发方便，灵活。

> 参考：[快速入门 - 灵境矩阵文档中心 (baidu.com)](https://agents.baidu.com/docs/intelligent-agent/visual-development/quickstart/)

### 3.1 开发套件

​	套件是可视化编排流程的构建块。它们由定义其功能的输入、输出和参数组成，为构建智能体提供了一种方便、直接的方法。

1. **套件类型**

   - 链：**用于编排主流程，智能体将遵循链的顺序执行后输出结果；** 平台提供大模型链、分支链等多种类型，用于表达智能体的业务逻辑。

   - 普通套件：除链外所有套件均为普通套件，可以与对应的链连接，**连接后将生效为链的基础属性**。

2. **套件操作**

   在流程创建过程中，您会注意到连接到套件一侧或两侧的连接点（蓝色圆形 ○ 或紫色菱形 ◇ ）。这些连接点代表连接到其他套件的可用性，将鼠标悬停在连接点上可查看连接详细信息。其中紫色菱形代表链与链的连接点，左侧为输入，右侧为输出；蓝色圆形代表链与其他套件，或其他套件之间的连接点，左侧为输入，右侧为输出。

   > **示例说明：**
   >
   > 如果您选择一个大模型链套件，您将看到蓝色 ○ 和紫色 ◇ 连接点。它们表明该链套件接受模型和提示词套件作为输入，红色星号 * 表示必须连接该类型的输入；同时接受与其他的链通过紫色 ◇ 连接。
   >
   > ![c3jpe9gg](https://raw.githubusercontent.com/ZzDarker/figure/main/img/c3jpe9gg.png)
   >
   > 套件卡片的右上角为套件状态图标。在建立必要的连接，发起测试并验证通过后，每个已验证套件的状态应呈绿色；当验证失败时遇到错误的套件的状态应呈红色，将鼠标悬停在失败状态上可显示检测到的错误。

#### 3.1.1 链（Chains）

> 在详细了解每个套件之前，先来明确一些概念，以便于更好地理解套件的具体功能～
>
> - 传入对话历史记录：常见配置项，控制是否要将历史对话记录传入模型作为上下文；
> - 输出关键词：常见配置项，当前链的输出结果，您可以通过 `{variable_name}` 的格式表达希望传入下个链的变量们；
> - 默认变量：`{_input_}`代表用户输入，此变量可以生效于画布内所有套件。

1. 大模型链（LLMChain）

   大模型链（LLMChain）可以将多个输入转化为模型提示，支持进一步格式化输出。

   ![image-20240323223520970](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240323223520970.png)

   参数说明：

   > 1）输入连接点：模型、提示词
   > 2）输出连接点：无
   > 3）配置项:
   >
   > - 传入对话历史记录：开关，控制是否要将历史对话记录传入模型作为上下文
   > - 输出关键词：非必填，设置链的输出结果说明
   >
   > 4）链连接点：有链输入/输出连接点，可以与其他任意链相连。

2. 分支链（RouterChain）

   分支链（RouterChain）的主要功能是动态选择下一个要调用的链，可以根据输入内容路由到不同的子链。

   ![image-20240323223642822](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240323223642822.png)

   参数说明：

   > 1）输入连接点：模型、提示词
   > 2）输出连接点：无
   > 3）配置项：
   >
   > - 传入对话历史记录：开关，控制是否要将历史对话记录传入模型作为上下文
   > - 输出关键词：非必填，设置链的输出结果说明
   >
   > 4）链连接点：
   >
   > - 链输入连接点：可以与其他任意链相连
   > - 链输出连接点：需要配置意图，每个意图对应一个链输出连接点
   > - - 普通意图：必填，支持添加多条。用来表达不同的意图对应关系，基于意图分流到其他子链；
   >   - 默认意图：必填，未命中普通意图时，将按默认意图执行

3. 检索链（RetrievalChain）

   检索链（RetrievalChain）可调用知识库文件，并基于模型能力进行查询。

   ![image-20240323223751588](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240323223751588.png)

   参数说明：

   > 1）输入连接点：模型、提示词、知识库
   > 2）输出连接点：无
   > 3）配置项：
   >
   > - 传入对话历史记录：开关，控制是否要将历史对话记录传入模型作为上下文
   >
   > 4）链连接点：有链输入/输出连接点，可以与其他任意链相连

4. 工具链（ToolChain）

   工具链（ToolChain）可调用工具进行查询。

   ![image-20240323223910595](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240323223910595.png)

   参数说明：

   > 1）输入连接点：工具
   > 2）输出连接点：无
   > 3）配置项：
   >
   > - 输出关键词：非必填，设置链的输出结果说明
   >
   > 4）链连接点：有链输入/输出连接点，可以与其他任意链相连

5. 提问链（AskChain）

   提问链（AskChain）用于指定意图，调用提问组件引导用户补充提问。

   ![image-20240323224015892](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240323224015892.png)

   参数说明：

   > 1）输入连接点：提问气泡
   > 2）输出连接点：无
   > 3）配置项：
   >
   > - 强制意图：必填，设置用户按照引导完成补充提问后，模型应该执行的意图；强制意图必须在其连接的分支链意图列表内，以保证用户回复的内容可以回到主流程；
   >
   > 4）链连接点：
   >
   > - 输入连接点必须为分支链；
   > - 无输出连接点；

#### 3.1.2 普通套件

1. 提示词模板（PromptTemplate）

   提示词模板（PromptTemplate）用于创建提示并定义输出格式，作为指令提供给模型。

   ![image-20240323224213021](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240323224213021.png)

   参数说明：

   > 1）输入连接点：无
   > 2）输出连接点：链（支持大模型链、分支链、检索链）
   > 3）配置项：
   >
   > - 模板：必填，您可以创建提示模板并定义变量来控制指示模型。变量可用于定义模型的指令、问题、上下文、输入或示例，并且可以使用大括号中的任何选定名称来创建，例如`{variable_name}`。它们充当可以轻松修改的文本部分的占位符。在交互式流程中，可以使用默认变量 `{_input_}` 来充当用户的聊天输入）
   > - 输出格式：您可以使用 json 编辑器编写内容，来指定回答结果的输出格式

2. 文心模型（ERNIE）

   文心一言（ERNIE）是百度发布的知识增强大语言模型。

   ![image-20240323224327796](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240323224327796.png)

   参数说明：

   > 1）输入连接点：无
   > 2）输出连接点：链（支持大模型链、分支链、检索链）
   > 3）配置项：
   >
   > - 模型名称：当前流程需使用的模型，目前可选ERNIE-bot、ERNIE-bot-turbo、ERNIE-bot 4：
   > - 温度：即 Temperature，数值越高，输出内容越随机；反之，数值越低，输出内容越集中和确定
   > - 多样性：即 Top-P，数值越高，输出内容越特殊；反之，数值越低，输出内容越常规

3. 数据集（VectorStore）

   数据集（VectorStore）用于调用您已上传并完成处理的数据文件，作为模型查询的来源。

   ![image-20240323224430765](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240323224430765.png)

   参数说明：

   > 1）输入连接点：无
   > 2）输出连接点：检索链
   > 3）配置项：
   >
   > - 数据集选择：您可以在此选择已经上传并处理成功的数据集，或点击“新建”跳转至数据集管理模块进行新增。注意，只有已处理成功的数据集才会展示在列表中供选择

4. HTTP 请求工具（RequestTool）

   HTTP 请求工具（RequestTool），用于发起请求并返回结果。

   ![image-20240323224526604](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240323224526604.png)

   参数说明：

   > 1）输入连接点：无
   > 2）输出连接点：工具链
   > 3）配置项：
   >
   > - 请求链接：必填，请求的 URL
   > - 请求方法：目前平台支持 GET 和 POST 方法，更多方法敬请期待
   > - Headers：可通过 key-value 的形式输入
   > - Query：可通过 key-value 的形式输入
   > - Body：可通过 json 编辑器输入

5. 百度搜索工具（BaiduSearchTool）

   百度搜索工具（BaiduSearchTool），用于查询百度搜索结果，返回结果标题、链接、摘要等内容。

   ![image-20240323224618787](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240323224618787.png)

   参数说明：

   > 1）输入连接点：无
   > 2）输出连接点：工具链
   > 3）配置项：
   >
   > - 搜索词：必填，输入需要请求百度搜索的关键词

6. 提问气泡（AskUI）

   提问气泡（AskUI）提供了一系列 GUI 组件，以更直观的方式引导用户提问。

   ![image-20240323224712898](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240323224712898.png)

   参数说明：

   > 1）输入连接点：无
   > 2）输出连接点：提问链
   > 3）配置项：
   >
   > - 组件选择：必填，用于选择要使用的 UI 组件，目前仅提供 “选择器”，更多组件完善中，敬请期待
   > - 组件配置：必填，配置内容与组件类型关联，现介绍选择器配置如下：
   > - - 标题：需要用户补充输入的问题
   >   - 选项：最多可添加 6 个选项，目前仅支持单选
   > - 输出变量：必填，设置提问气泡组件输出结果的变量名称，可用于被下游或提示词模板中引用，默认值为 “value”
   > - 提示词模板：您可以创建提示模板并定义变量来控制指示模型。变量可用于定义模型的指令、问题、上下文、输入或示例，并且可以使用大括号中的任何选定名称来创建。例如`{variable_name}`格式可以作为变量使用，还可以使用默认变量`{_input_}`来充当用户的聊天输入）

### 3.2 工作流

​	以下工作流示例供您参考，以便于更好的理解各个套件的连接方式和功能。

1. **大模型链** 的使用

   **使用模型链，通过模型和提示词构建笑话生成器**

   默认变量`{_input_}`用于获取用户输入，您可以在提示词中使用`{_input_}`来定义模型如何基于用户输入，输出指定内容。

   ![1711205430120](https://raw.githubusercontent.com/ZzDarker/figure/main/img/1711205430120.jpg)

2.  **检索链** 的使用

   **使用检索链，通过外挂数据集和模型能力，构建 mysql 知识查询助手**

   通过构建的数据集，使用检索链进行输出。

   ![1711205463435](https://raw.githubusercontent.com/ZzDarker/figure/main/img/1711205463435.jpg)

3. **工具链** 的使用

   **使用大模型链和工具链，构建天气查询助手**

   通过输出关键词，实现多个链之间的数据传递：下游链可以通过上游链的输出关键词来获取上游链的输出；

   > 注意：输出关键词只能在相邻的两个链传递

   ![1711205770365](https://raw.githubusercontent.com/ZzDarker/figure/main/img/1711205770365.jpg)

4. **提示词模版** 的使用

   **使用多个模型链，制作可以输出指定格式的笑话生成器**

   - 通过提示词模板中的输出格式功能，指定笑话内容输出的格式；

     ![1711205847996](https://raw.githubusercontent.com/ZzDarker/figure/main/img/1711205847996.jpg)

   - 下游链引用上游多变量可以使用 outputKey 组合语法来获取

     ![1711205875645](https://raw.githubusercontent.com/ZzDarker/figure/main/img/1711205875645.jpg)

5. **分支链与提问链** 的使用

   **使用分支链和提问链，搭建可以根据用户不同意图输出内容的综合助手**

   - 分支链可以配置多个意图，当用户输入命中意图时，将执行对应分支；识别到不存在的意图则执行默认意图；
   - 提问链可以连接选择器气泡样式，用户完成交互后，会直接执行分支链关联的强制意图。

   ![1711205931905](https://raw.githubusercontent.com/ZzDarker/figure/main/img/1711205931905.jpg)

### 3.3 低代码开发流程

​	低代码模式支持开发者通过编排工作流的方式快速构建智能体，您可以通过拖拽和组合模型、提示词、代码等模块，实现准确的、复杂的业务流程。
​	戳此观看视频课程[《低代码智能体开发实战》](https://mbd.baidu.com/newspage/data/videolanding?nid=sv_2895643723002399034)。

1. 创建

   登录平台后，从左侧点击"创建智能体"，选择"低代码" 立即创建。

   ![1711206047075](https://raw.githubusercontent.com/ZzDarker/figure/main/img/1711206047075.jpg)

   在可视化编排面板中填写名称和简介，并上传头像图片，即可完成创建。

   ![1711206078285](https://raw.githubusercontent.com/ZzDarker/figure/main/img/1711206078285.jpg)

2. 流程搭建

   使用可视化编排创建智能体工作流非常简单，将侧边栏套件拖到画布上并将它们连接在一起以创建通路。灵境矩阵提供了一系列开发套件可供选择，包括链、模型、提示词等。

   ![1711206101895](https://raw.githubusercontent.com/ZzDarker/figure/main/img/1711206101895.jpg)

3. 流程测试

   测试流程是为了验证套件是否完成配置并正确搭建通路。测试成功后，可在预览界面发送聊天消息，运行智能体验证效果。

   ![1711206127715](https://raw.githubusercontent.com/ZzDarker/figure/main/img/1711206127715.jpg)

   新增或删除画布中的组件，修改组件的连接关系、组件参数，需要重新点击测试，当展示错误提示时，表示当前画布中存在构建错误，可以根据提示信息以及《开发套件》文档修改，修改后需重新测试验证错误是否修复。

   ![1711206153446](https://raw.githubusercontent.com/ZzDarker/figure/main/img/1711206153446.jpg)

   画布中的测试问题，全部保存在错误报告中，已修复的错误会自动删除。

4. 预览

   聊天界面提供了与智能体交互的友好体验，可以模拟用户与智能体对话的实际场景，获取真实反馈。

   测试成功后才能支持预览，若当前测试存在错误报告，或未进行测试验证，则无法进行预览。

   > 注意：每次测试成功后，可以预览 8 小时，8 小时后需要重新点击测试发起预览。

   ![1711206192861](https://raw.githubusercontent.com/ZzDarker/figure/main/img/1711206192861.jpg)

## 4 灵境 Agent 插件开发

​	灵境矩阵可以支持自己构建插件，用于丰富 Agent 的功能。

> 官方文档：[快速入门 - 灵境矩阵文档中心 (baidu.com)](https://agents.baidu.com/docs/develop/ability-plugin/basic/quick_start/)

### 4.1 官方demo学习

​	官方为了方便用户学习，准备了一套可供本地调试的示例 demo，[点此下载](https://lingjing-online.bj.bcebos.com/lingjing-online/document/2023-12-14/plugin-demo.zip)。demo文件结构如下所示：

```bash
ljplugin_demo/           # 插件demo注册的根目录
|—.well-known
  |— ai-plugin.json         #插件主描述文件
  |— openapi.yaml          #插件API服务的标准描述文件
|— logo.png               #插件的图标文件
|— server.py          #插件注册服务，可以启动到本地
|— requirements.txt         #启动插件注册服务所依赖的库，要求python >= 3.7
|— readme.md              # 说明文件
```

1. 
