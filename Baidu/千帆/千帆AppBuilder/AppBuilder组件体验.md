# AppBuilder低代码体验：构建雅思大作文组件

> ​	在4月14日，AppBuilder赢来了一次大更新，具体更新内容见：[AppBuilder 2024.04.14发版上线公告](https://cloud.baidu.com/qianfandev/topic/269671) 。本次更新最大的亮点就是**新增了工作流，低代码制作组件。**具体包括：
>
> - 自定义组件：支持用户自定义创建组件，并被Agent自动编排调用 。
> - 工作流框架：组件支持流式编排、调试和发布 。
> - 工作流预置画布：空画布、知识问答、LLM 理解与生成、API 接入、多类型复合 。
> - 工作流基础节点：开始节点、结束节点、大模型节点、知识库节点、API 节点和分支器节点 。
>
> 参考：
>
> [1] [AppBuilder 2024.04.14发版上线公告](https://cloud.baidu.com/qianfandev/topic/269671)
>
> [2] [AppBuilder工作流组件官方文档](https://cloud.baidu.com/doc/AppBuilder/s/glv0f48qe)
>
> [3] [AppBuilder工作流编排体验：智能组件构建新范式](https://cloud.baidu.com/qianfandev/topic/269756)

​	AppBuilder上线了低代码制作组件功能，可以通过工作流的方式构建自定义组件，完成简单Agent无法完成的复杂功能，使得生成的文本更加定制化，根据开发者制定的规则完成任务。

​	本次我尝试了利用工作流组件，创作一个雅思大作文写作助手，可以根据用户要求，完成特定格式的雅思大作文。

## 1 设计思路

​	雅思大作文一般都是议论文，往往是给出一个话题，可能是有关环境、文化或某种社会现象的阐述，让考生依据这个现象给出自己的观点，完成一篇不少于250词的英语议论文。

​	雅思写作的思路一般如下：

1. 根据话题，提取关键词，给出总观点。
2. 根据总观点，分解成3、4个分论点。
3. 根据总观点，撰写开头段。
4. 根据分论点，撰写2到3个展开段。
5. 撰写结尾段。

​	根据以上逻辑，便可撰写出一篇雅思大作文，而这样的逻辑性正好适合工作流组件的编排，于是选择创建一个雅思大作文助手的工作流组件。

## 2 AppBuilder 组件功能介绍

​	AppBuilder 组件工作流中，除了开始和结束节点以外，目前一共有5个基础节点，分别为大模型、知识库、API、分支器与代码节点，下面分别介绍每个结点的功能。

![image-20240511152520648](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240511152520648.png)

### 2.1 大模型节点

大模型节点可调用大语言模型，根据输入参数和提示词生成回复。大模型节点中可以配置：

- **大模型配置模板**：提供预制的示例模板，快速填写节点配置信息。

- **模型配置**：支持选择模型和多样性参数。

- **输入**：可以引用前序节点的参数，作为输入。此处的输入可以插入提示词中，作为变量。

- **提示词**：编写大模型的提示词，使大模型实现对应功能。通过插入花括号的方式，如 {{input}} ，可以引用对应的参数值。此处也可以在输出定义参数，并在提示词中引用，如 {{output1}}，指定大模型将对应信息按照参数的格式输出。

- **输出**：通过参数输出大模型的结果。有多个输出参数时，需要准确填写参数描述，并在提示词中指定每个参数的输出内容。

![image-20240511161105427](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240511161105427.png)

​	其中，右侧大模型配置模版中，给出了一些特定需求的案例，目前有 客户相似问题生成 ，标签抽取 ，复杂问题拆解 ，问答对挖取 4种，每种都有官方提供的提示词模版，方便大家在此基础上编写提示词。

![image-20240511163522046](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240511163522046.png)

​	下面给出具体提示词内容：

1. 客户相似问题生成

   ```
   针对客服问答场景，对提供的原始问题进行改写，生成3个相似的问题。
   要求：
   1.生成的问题之间文字不能相同，改写方式要有多样性
   2.对于原始问题中涉及到公司名称、品牌、地点等信息时相似问中对应信息不能变更
   3.生成的问题要与原始问题保持提问内容上的一致性
   
   示例原始问题：
   冰激凌5G套餐资费是多少？
   
   可参考的改写方法与示例：
   增加不影响语义的疑问词-请问冰激凌5G套餐的资费是多少呢？
   对原始问题的词语进行同义改写-冰激凌5G套餐的价格是多少？
   增加不影响问题内容的描述-能告诉我冰激凌5G套餐的收费标准吗？
   改变提问的句式-我想了解一下冰激凌5G套餐的资费情况，可以吗？
   综合多种改写方法-你们冰激凌5G套餐的费用是怎么计算的，能告诉我吗？
   
   原始问题：
   {{query}}
   请按照严格按照以下格式输出相似问题：
   {
   "output1":"(相似问题1)",
   "output2":"(相似问题2)",
   "output3":"(相似问题3)"
   }
   ```

2. 标签抽取

   ```
   从以下文本中归纳主题标签，每个标签尽可能不超过7字，标签需要在全文中完整的出现，不能生成没有见过的字符，输出3个结果，用数字编号： 
   
   文本：{{query}}
   
   主题标签：
   标签1: output1
   标签2: output2
   标签3: output3
   ```

3. 复杂问题拆解 

   ```
   你是问题拆解专家，擅长将复杂问题拆解为若干简单问题。
   复杂问题的定义：复杂问题通常是需要多个步骤的简单问题回答才能解决的，相对简单问题而言需要对较多的知识进行综合、分析、对比等思维活动。
   简单问题的定义：简单问题通常只需要简单的步骤就能回答，问题的答案通常是事实、数字、概念的解释等。
   
   请按照复杂问题和简单问题的定义，对如下复杂问题进行简单问题拆解，使得拆解后的3个子问题对应的答案能够更好的回答原始的复杂问题。
   
   复杂问题：{{query}}
   拆解后的简单问题：
   子问题1: output1
   子问题2: output2
   子问题3: output3
   ```

4. 问答对挖掘

   ```
   从以下输入文本中生成多个问题，并且给出问题的答案。下面是生成问题和答案的具体要求：
   1. 问题不可脱离文本，符合常见的中文语言习惯，问题应该适当总结文本或变换文本描述，使问题语言风格贴近人类，而不是对文本内容的重复叙述；
   2. 问题的答案能够通过输入文本中的信息回答，且需要保证文本的主题、关键信息都在答案中；
   3. 文本的非关键信息、非主题信息不要生成问题，空洞、无主题、语言混乱无逻辑的文本不要生成问题。
   
   输入文本：
   {{query}}
   
   问题和答案如下，
   问题1:output_q1
   答案1:output_a1
   问题2:output_q2
   答案2:output_a2
   ```

### 2.2 知识库节点

知识库节点支持根据输入的query，在选定的知识库中检索相关片段并召回，返回切片列表。你可以上传文件并建立知识库，在知识库节点中勾选想要使用的知识库进行检索。

- **输入参数**：参数名不可修改，参数类型为string，上级节点的输出参数会强制转换为string类型作为知识库节点的输入，输入参数有两种类型：1）引用类型为引用上一个节点的输出变量，2）常量类型，可以输入一个string类型的入参。

- **选择知识库**：选择需要检索的知识库，支持选择多个知识库。

- **检索策略**：按照指定的检索策略从知识库中寻找匹配的片段，不同的检索策略可以更有效地找到正确的信息，提高最终生成的答案的准确性和可用性。

- **召回数量**：设置从知识库中召回与输入Query匹配的知识片段的个数，设定的数量越大，召回的片段越多

- **匹配分**：在检索过程中，用来计算输入Query和知识库片段的相似度，高于匹配分数的片段将会被检索召回

- **输出参数**：在知识库中检索输出的变量信息及变量类型

![image-20240511164615961](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240511164615961.png)

### 2.3 API节点

API节点是基础节点类型之一，您可以通过该节点，将已有服务注册为组件，帮助扩展应用能力边界。

比如您有一个可以查询教育信息的接口，通过在API节点中注册接口信息，并发布为组件，就可以在应用配置的【组件】中选择该组件，那么该应用将按照要求查询对应信息。

当前API节点可支持标准的HTTP请求。

使用说明：

1. 添加API节点，编辑API节点的基本信息，包括：请求方式、访问资源URL、Headers信息、鉴权信息、请求参数信息、返回参数信息。您可以只填写必需的输入参数和返回参数。比如在返回参数配置中，若需输出返回数据中某个对象的完整内容，仅需设置最顶层参数信息并选择适当的参数类型。

2. 在API调试环节，可以通过表单或JSON方式填写输入参数并点击运行，运行成功后点击【保存】。

   ![1715417676597](https://raw.githubusercontent.com/ZzDarker/figure/main/img/1715417676597.jpg)

   ![1715417694168](https://raw.githubusercontent.com/ZzDarker/figure/main/img/1715417694168.jpg)

3. 继续在右侧面板中对输入参数进行值配置，您可以引用前序节点输出，或手动输入对应参数值。需要确保引用类型与设置类型一致。

   ![image (6)_71eb3e2](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image%20(6)_71eb3e2.png)

4. 在整体流程调试前，API节点需要为调试通过状态。

5. 点击调试，您可以对整个流程进行调试，查看每个节点的运行情况和最终输出结果。

   ![image (7)_50f2768](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image%20(7)_50f2768.png)

### 2.4 分支器节点

分支器节点可以连接两个下游节点。设定的条件成立则运行”如果"分支，不成立则运行“否则"分支。在如果分支中，可以选择条件关系，以及添加多个条件。

复杂的条件关系可以通过串联多个分支器节点实现。

![image-20240511165657740](https://raw.githubusercontent.com/ZzDarker/figure/main/img/image-20240511165657740.png)

### 2.5 代码节点

​	在代码节点中，可通过编写代码实现自定义的处理功能。引入代码节点到画布中，可在编辑器（IDE）内看到默认的示例代码。

![1715418038427](https://raw.githubusercontent.com/ZzDarker/figure/main/img/1715418038427.jpg)

![img](https://bce.bdstatic.com/doc/ai-cloud-share/AppBuilder/截屏2024-04-28 14.41.13_c0bd42c.png)

编辑器的使用：

- 引用输入：配置了输入参数名和参数值后，可以在编辑器中引用输入参数。编辑器引入输入参数时，需要通过字典变量 params 引入代码节点的输入参数。
- 返回输出：需要在编辑器中定义一个字典变量，作为编辑器中函数的输出。代码节点的输出参数是该字典变量的键（key）。
- 运行时环境：编辑器支持的运行时环境为 Python 3 。 运行环境预制了 NumPy 包。 

编辑器测试功能：

- 输入测试：在输入测试区域可以输入测试数据，并进行调试运行。“自动填入” 功能可以根据当前输入参数类型，生成输入数据。

![img](https://bce.bdstatic.com/doc/ai-cloud-share/AppBuilder/截屏2024-04-26 15.46.55的副本2_cc90ed3.png)

- 输出测试：测试数据的运行结果会展示在输出测试区域中。运行成功后可以使用 “更新节点 Schema” 功能。使用后，代码节点的输出配置信息将被输出测试的 schema 自动覆盖。

![img](https://bce.bdstatic.com/doc/ai-cloud-share/AppBuilder/image_d6ca36e.png)

